{
  "name": "oauth",
  "label": "OAuth Package",
  "dependencies": [
    {
      "type": "service",
      "name": "http",
      "version": "v1.1.5",
      "instanceId": "shared"
    }
  ],
  "configuration": [
    {
      "name": "authenticationMethod",
      "label": "Authentication Method",
      "required": true,
      "defaultValue": "apiKey",
      "type": "buttonsGroup",
      "typeOptions": {
        "allowCustom": false,
        "possibleValues": [
          {
            "label": "ApiKey",
            "name": "apiKey"
          },
          {
            "label": "OAuth 1.0",
            "name": "oauth1"
          },
          {
            "label": "OAuth 2.0",
            "name": "oauth2"
          }
        ]
      }
    },
    {
      "name": "oAuth2AuthenticationType",
      "label": "OAuth 2.0 Authentication Type",
      "required": true,
      "defaultValue": "userAuthentication",
      "type": "buttonsGroup",
      "visibility": "config.authenticationMethod == 'oauth2'",
      "typeOptions": {
        "allowCustom": false,
        "possibleValues": [
          {
            "label": "User Authentication",
            "name": "userAuthentication"
          },
          {
            "label": "Application Authentication",
            "name": "applicationAuthentication"
          }
        ]
      }
    },
    {
      "name": "apiKey",
      "label": "API Key",
      "type": "text",
      "required": "config.authenticationMethod == 'apiKey'",
      "visibility": "config.authenticationMethod == 'apiKey'"
    },
    {
      "label": "Auth URL",
      "name": "authUrl",
      "type": "text",
      "required": "config.authenticationMethod == 'oauth2'",
      "visibility": "config.authenticationMethod == 'oauth2'"
    },
    {
      "label": "Access Token URL",
      "name": "accessTokenUrl",
      "type": "text",
      "required": "config.authenticationMethod == 'oauth2'",
      "visibility": "config.authenticationMethod == 'oauth2'"
    },
    {
      "label": "Client Id",
      "name": "clientId",
      "type": "text",
      "required": "config.authenticationMethod == 'oauth2'",
      "visibility": "config.authenticationMethod == 'oauth2'"
    },
    {
      "label": "Client Secret",
      "name": "clientSecret",
      "type": "text",
      "required": "config.authenticationMethod == 'oauth2'",
      "visibility": "config.authenticationMethod == 'oauth2'"
    },
    {
      "label": "Scope",
      "name": "scope",
      "type": "text",
      "required": "config.authenticationMethod == 'oauth2'",
      "visibility": "config.authenticationMethod == 'oauth2'"
    },
    {
      "label": "State",
      "name": "state",
      "type": "text",
      "required": "config.authenticationMethod == 'oauth2'",
      "visibility": "config.authenticationMethod == 'oauth2'"
    },
    {
      "label": "OAuth callback",
      "name": "oauthCallback",
      "description": "The OAuth callback to configure in your App",
      "type": "label",
      "value": "config.WEBHOOK_URL+'/authCallback'",
      "required": "config.authenticationMethod == 'oauth2'",
      "visibility": "config.authenticationMethod == 'oauth2'"
    },
    {
      "name": "webhooksUrl",
      "label": "Webhooks URL",
      "description": "The URL to configure in webhooks of your GitHub App",
      "type": "label",
      "value": "@config.WEBHOOK_URL"
    },
    {
      "name": "requestToken",
      "label": "Request token",
      "type": "oAuth2",
      "visibility": "config.authenticationMethod == 'oauth2' && config.oAuth2AuthenticationType == 'applicationAuthentication'",
      "typeOptions": {
        "clientId": "config.clientId",
        "clientSecret": "config.clientSecret",
        "authUrl": "config.authUrl",
        "accessTokenUrl": "config.accessTokenUrl",
        "scope": "config.scope",
        "grantType": "'authorization_code'",
        "accessToken": "@config.accessToken",
        "refreshToken": "@config.refreshToken"
      }
    },
    {
      "name": "accessToken",
      "label": "Access token",
      "type": "label",
      "value": "@config.accessToken",
      "visibility": "config.authenticationMethod == 'oauth2' && config.oAuth2AuthenticationType == 'applicationAuthentication'"
    },
    {
      "name": "refreshToken",
      "label": "Refresh token",
      "type": "label",
      "value": "@config.refreshToken",
      "visibility": "config.authenticationMethod == 'oauth2' && config.oAuth2AuthenticationType == 'applicationAuthentication'"
    }
  ],
  "events": [
    {
      "label": "Webhook",
      "name": "webhook",
      "description": "Happens when SharePoint sends a webhook to the endpoint."
    }
  ],
  "metadata": [
    {
      "type": "script",
      "namespace": "api",
      "path": "/scripts/functions.js"
    },
    {
      "type": "uiService",
      "namespace": "oAuth",
      "path": "/uiServices/oAuth"
    }
  ]
}